<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente Digital de Herramientas de Soldadura Móvil (ADHSM)</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e2e8f0; /* slate-200 */
        }
        /* Estilo para tabla de resultados con notación LaTeX */
        .latex-formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }
    </style>
</head>
<body>

<!-- Contenedor Principal (Simulación de la App Móvil) -->
<div class="min-h-screen flex items-start justify-center p-4">
    <div class="w-full max-w-lg bg-white shadow-2xl rounded-2xl p-6 border-t-8 border-cyan-600 mt-4 md:mt-8">
        
        <!-- Encabezado de la Aplicación -->
        <header class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-900">Pocket Welder Helper (ADHSM)</h1>
            <p class="text-sm text-cyan-600 font-medium">Asistente Digital de Herramientas de Soldadura Móvil</p>
        </header>

        <!-- Contenedor Dinámico de Módulos -->
        <div id="app-container">
            <!-- El contenido se cargará aquí por JavaScript -->
        </div>

        <!-- Área de Mensajes (Modal no-alert) -->
        <div id="message-box" class="mt-4 p-3 text-sm rounded-lg text-center hidden"></div>
        
        <!-- Instrucción de Cierre (Fija) -->
        <div class="mt-6 pt-4 border-t border-gray-200 text-center">
            <p class="text-xs text-gray-500 font-medium">Simulación de Pocket Welder Helper, un valioso activo para la productividad en soldadura.</p>
        </div>

    </div>
</div>

<script>
    let currentModule = 0; // 0: Menu, 1: Params, 2: Budget, 3: Reference
    const appContainer = document.getElementById('app-container');
    const messageBox = document.getElementById('message-box');

    // --- BASE DE CONOCIMIENTO (MÓDULO 1) ---
    const PARAMETER_GUIDE = {
        'MIG/MAG_Acero al Carbono_1.0': { I: '180 - 230', U: '23.0 - 25.5', Vf: '8.0 - 11.0', Fg: '15 - 18', Gas: 'Ar + 18% CO₂ (M21)' },
        'MIG/MAG_Acero al Carbono_1.2': { I: '220 - 280', U: '25.0 - 28.0', Vf: '6.5 - 9.0', Fg: '16 - 20', Gas: 'Ar + 18% CO₂ (M21)' },
        'MIG/MAG_Acero Inoxidable_1.0': { I: '160 - 200', U: '22.0 - 24.5', Vf: '7.0 - 9.0', Fg: '12 - 15', Gas: 'Ar + 2% O₂ (M12)' },
        'MIG/MAG_Aluminio_1.2': { I: '190 - 250', U: '20.0 - 24.0', Vf: '10.0 - 15.0', Fg: '18 - 25', Gas: 'Argón Puro (I1)' },
        'TIG DC_Acero Inoxidable_2.4': { I: '140 - 180', U: '10.0 - 14.0', Vf: 'N/A', Fg: '8 - 12', Gas: 'Argón Puro (I1)' },
        'TIG AC_Aluminio_2.4': { I: '160 - 210', U: '12.0 - 16.0', Vf: 'N/A', Fg: '10 - 15', Gas: 'Argón Puro (I1)' },
        'SMAW_Acero al Carbono_3.2': { I: '90 - 130', U: '20.0 - 24.0', Vf: 'N/A', Fg: 'N/A', Gas: 'N/A' },
    };

    // --- UI HELPERS ---

    function displayMessage(text, isError = false) {
        messageBox.textContent = text;
        messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
        if (isError) {
            messageBox.classList.add('bg-red-100', 'text-red-700');
        } else {
            messageBox.classList.add('bg-green-100', 'text-green-700');
        }
    }

    // --- MÓDULO DE MENÚ (Principal) ---

    function renderMenu() {
        currentModule = 0;
        messageBox.classList.add('hidden');
        appContainer.innerHTML = `
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">Menú Principal</h2>
            <div class="space-y-4">
                <button onclick="renderModule1Input()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150">
                    <span class="text-xl mr-2">1</span> Cálculo Rápido de Parámetros de Máquina
                </button>
                <button onclick="renderModule2Input()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150">
                    <span class="text-xl mr-2">2</span> Módulo de Estimación de Presupuesto
                </button>
                <button onclick="renderModule3()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150">
                    <span class="text-xl mr-2">3</span> Tabla de Referencia Rápida
                </button>
            </div>
        `;
    }

    // --- MÓDULO 1: CÁLCULO RÁPIDO DE PARÁMETROS ---

    function renderModule1Input() {
        currentModule = 1;
        messageBox.classList.add('hidden');
        appContainer.innerHTML = `
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center border-b pb-2">Módulo 1: Parámetros de Máquina</h2>
            <p class="text-sm text-gray-600 mb-4">Ingrese los datos para obtener los ajustes $I$, $U$ y $V_f$ optimizados.</p>
            <div class="space-y-3">
                <!-- Proceso -->
                <div>
                    <label for="p1_process" class="block text-sm font-medium text-gray-700">Proceso</label>
                    <select id="p1_process" class="w-full p-2 border border-gray-300 rounded-lg">
                        <option value="">Seleccione...</option>
                        <option value="MIG/MAG">MIG/MAG</option>
                        <option value="TIG DC">TIG DC</option>
                        <option value="TIG AC">TIG AC</option>
                        <option value="SMAW">Electrodo Revestido (SMAW)</option>
                    </select>
                </div>
                <!-- Material -->
                <div>
                    <label for="p1_material" class="block text-sm font-medium text-gray-700">Material Base</label>
                    <select id="p1_material" class="w-full p-2 border border-gray-300 rounded-lg">
                        <option value="">Seleccione...</option>
                        <option value="Acero al Carbono">Acero al Carbono</option>
                        <option value="Acero Inoxidable">Acero Inoxidable</option>
                        <option value="Aluminio">Aluminio</option>
                    </select>
                </div>
                <!-- Espesor -->
                <div>
                    <label for="p1_thickness" class="block text-sm font-medium text-gray-700">Espesor ($e$) en mm</label>
                    <input type="number" id="p1_thickness" step="0.5" placeholder="Ej: 6.0" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <!-- Diámetro -->
                <div>
                    <label for="p1_diameter" class="block text-sm font-medium text-gray-700">Diámetro del Consumible (Ø) en mm</label>
                    <select id="p1_diameter" class="w-full p-2 border border-gray-300 rounded-lg">
                        <option value="">Seleccione...</option>
                        <option value="1.0">1.0 mm</option>
                        <option value="1.2">1.2 mm</option>
                        <option value="2.4">2.4 mm (TIG)</option>
                        <option value="3.2">3.2 mm (SMAW)</option>
                    </select>
                </div>
            </div>

            <button onclick="calculateParams()" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 mt-6 rounded-lg shadow-md transition duration-150">
                Calcular Ajustes
            </button>
            <button onclick="renderMenu()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 mt-3 rounded-lg transition duration-150">
                ← Volver al Menú
            </button>
            <div id="module1_results" class="mt-6 hidden"></div>
        `;
    }

    function calculateParams() {
        const process = document.getElementById('p1_process').value;
        const material = document.getElementById('p1_material').value;
        const thickness = parseFloat(document.getElementById('p1_thickness').value);
        const diameter = document.getElementById('p1_diameter').value;

        if (!process || !material || isNaN(thickness) || !diameter) {
            displayMessage("ADHSM: Error en la entrada. Por favor, complete todos los campos.", true);
            return;
        }

        const key = `${process}_${material}_${diameter}`;
        let params = PARAMETER_GUIDE[key];

        if (!params) {
            displayMessage(`ADHSM: No se encontró una referencia directa para ${key}. Use la Tabla de Referencia Rápida para más detalles.`, true);
            return;
        }

        // Aplicar ajuste basado en espesor (Simulación de ajuste I)
        let [minI, maxI] = params.I.split(' - ').map(Number);

        if (process.includes('MIG/MAG') || process.includes('SMAW')) {
            if (thickness < 5) { // Espesores delgados, ajuste a la baja
                minI = Math.round(minI * 0.85);
                maxI = Math.round(maxI * 0.95);
            } else if (thickness > 15) { // Espesores gruesos, ajuste al alza
                minI = Math.round(minI * 1.05);
                maxI = Math.round(maxI * 1.15);
            }
        }
        
        // Formatear resultados
        params.I_adjusted = `${minI} - ${maxI}`;

        renderModule1Results(params, process);
    }

    function renderModule1Results(params, process) {
        const resultsDiv = document.getElementById('module1_results');
        const isMIG = process.includes('MIG/MAG');
        
        resultsDiv.innerHTML = `
            <h3 class="text-lg font-bold text-gray-800 mb-3 border-b border-gray-200 pb-1">Parámetros Optimizado (Inicio)</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-300 rounded-lg text-sm">
                    <thead>
                        <tr class="bg-cyan-50">
                            <th class="px-4 py-2 text-left text-gray-700">Parámetro</th>
                            <th class="px-4 py-2 text-left text-gray-700">Rango Optimizado Sugerido</th>
                            <th class="px-4 py-2 text-left text-gray-700">Unidad</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-t">
                            <td class="px-4 py-3 font-medium text-gray-800">Corriente ($\text{I}$)</td>
                            <td class="px-4 py-3 text-cyan-600 font-bold latex-formula">${params.I_adjusted}</td>
                            <td class="px-4 py-3">Amperios ($\text{A}$)</td>
                        </tr>
                        <tr class="border-t bg-gray-50">
                            <td class="px-4 py-3 font-medium text-gray-800">Voltaje de Arco ($\text{U}$)</td>
                            <td class="px-4 py-3 text-cyan-600 font-bold latex-formula">${params.U}</td>
                            <td class="px-4 py-3">Voltios ($\text{V}$)</td>
                        </tr>
                        <tr class="border-t ${isMIG ? '' : 'hidden'}">
                            <td class="px-4 py-3 font-medium text-gray-800">Vel. Alimentación ($\text{V}_\text{f}$)</td>
                            <td class="px-4 py-3 text-cyan-600 font-bold latex-formula">${params.Vf}</td>
                            <td class="px-4 py-3">m/min</td>
                        </tr>
                        <tr class="border-t ${isMIG ? 'bg-gray-50' : ''}">
                            <td class="px-4 py-3 font-medium text-gray-800">Flujo de Gas ($\text{F}_\text{g}$)</td>
                            <td class="px-4 py-3 text-cyan-600 font-bold latex-formula">${params.Fg}</td>
                            <td class="px-4 py-3">L/min</td>
                        </tr>
                        <tr class="border-t bg-cyan-50">
                            <td colspan="3" class="px-4 py-3 text-xs text-gray-700 font-medium">Gas Protector Típico: ${params.Gas}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;
        resultsDiv.classList.remove('hidden');
        displayMessage("ADHSM: Cálculo de parámetros completado. Estos rangos son el punto de partida ideal.", false);
    }

    // --- MÓDULO 2: ESTIMACIÓN DE PRESUPUESTO ---

    function renderModule2Input() {
        currentModule = 2;
        messageBox.classList.add('hidden');
        appContainer.innerHTML = `
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center border-b pb-2">Módulo 2: Estimación de Presupuesto</h2>
            <p class="text-sm text-gray-600 mb-4">Ingrese los datos financieros y de producción para estimar el costo total.</p>
            <div class="space-y-3">
                <!-- Longitud Total -->
                <div>
                    <label for="p2_length" class="block text-sm font-medium text-gray-700">Longitud Total del Cordón ($L$) en metros</label>
                    <input type="number" id="p2_length" step="0.1" placeholder="Ej: 50.0" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <!-- Tasa de Deposición -->
                <div>
                    <label for="p2_dr" class="block text-sm font-medium text-gray-700">Tasa de Deposición Estimada ($\text{DR}$) en kg/h</label>
                    <input type="number" id="p2_dr" step="0.1" placeholder="Ej: 1.5 (Valor Conservador)" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <!-- Costo Consumible -->
                <div>
                    <label for="p2_cc" class="block text-sm font-medium text-gray-700">Costo del Consumible ($\text{C}_c$) por kg (USD)</label>
                    <input type="number" id="p2_cc" step="0.01" placeholder="Ej: 15.00" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <!-- Costo Soldador -->
                <div>
                    <label for="p2_ch" class="block text-sm font-medium text-gray-700">Costo por Hora del Soldador ($\text{C}_h$) (USD/hora)</label>
                    <input type="number" id="p2_ch" step="0.01" placeholder="Ej: 30.00" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>

            <button onclick="calculateBudget()" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 mt-6 rounded-lg shadow-md transition duration-150">
                Calcular Presupuesto
            </button>
            <button onclick="renderMenu()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 mt-3 rounded-lg transition duration-150">
                ← Volver al Menú
            </button>
            <div id="module2_results" class="mt-6 hidden"></div>
        `;
    }

    function calculateBudget() {
        const L = parseFloat(document.getElementById('p2_length').value);
        const DR = parseFloat(document.getElementById('p2_dr').value);
        const Cc = parseFloat(document.getElementById('p2_cc').value);
        const Ch = parseFloat(document.getElementById('p2_ch').value);
        
        const FactorConsumo = 0.007; // kg/m (factor conservador para una pasada)

        if (isNaN(L) || isNaN(DR) || isNaN(Cc) || isNaN(Ch) || DR <= 0) {
            displayMessage("ADHSM: Error en la entrada. Verifique que todos los valores sean numéricos y DR > 0.", true);
            return;
        }

        // 1. Masa de Consumible (M)
        const M = L * FactorConsumo;
        
        // 2. Tiempo de Soldadura Neto (T_neto)
        const T_neto = M / DR;

        // 3. Costo de Material (C_m)
        const Cm = M * Cc;

        // 4. Costo de Mano de Obra (C_h)
        const Ch_total = T_neto * Ch;

        // 5. Presupuesto Total (C_total)
        const C_total = Cm + Ch_total;

        renderModule2Results(L, DR, FactorConsumo, M, T_neto, Cm, Ch_total, C_total);
    }

    function renderModule2Results(L, DR, FC, M, T_neto, Cm, Ch_total, C_total) {
        const resultsDiv = document.getElementById('module2_results');
        
        resultsDiv.innerHTML = `
            <h3 class="text-lg font-bold text-gray-800 mb-3 border-b border-gray-200 pb-1">Reporte de Costos Estimado</h3>
            
            <div class="space-y-4 p-4 bg-gray-50 rounded-lg border">
                <p class="text-sm font-semibold text-gray-700">Longitud Total ($\text{L}$): <span class="float-right text-cyan-600">${L.toFixed(1)} m</span></p>
                <p class="text-sm font-semibold text-gray-700">Tasa de Deposición ($\text{DR}$): <span class="float-right text-cyan-600">${DR.toFixed(2)} kg/h</span></p>
                
                <div class="pt-2 border-t border-gray-200">
                    <p class="text-xs text-gray-500 mb-1">Fórmula Masa de Consumible: $M = L \\times \\text{Factor de Consumo}$</p>
                    <p class="text-sm font-bold text-gray-800">Masa Requerida ($\text{M}$): <span class="float-right text-indigo-700">${M.toFixed(3)} kg</span></p>
                </div>

                <div class="pt-2 border-t border-gray-200">
                    <p class="text-xs text-gray-500 mb-1">Fórmula Tiempo Neto: $T_{\\text{neto}} = M / \\text{DR}$</p>
                    <p class="text-sm font-bold text-gray-800">Tiempo Soldadura Est. ($\text{T}_{\text{neto}}$): <span class="float-right text-indigo-700">${T_neto.toFixed(2)} horas</span></p>
                </div>
            </div>

            <div class="mt-4 p-4 bg-cyan-50 rounded-lg border border-cyan-300">
                <h4 class="font-bold text-md text-cyan-800 mb-2">Resumen Financiero</h4>
                <p class="text-sm font-medium text-gray-800">Costo Material ($\text{C}_m$): <span class="float-right font-bold text-red-600">USD ${Cm.toFixed(2)}</span></p>
                <p class="text-sm font-medium text-gray-800">Costo Mano de Obra ($\text{C}_h$): <span class="float-right font-bold text-red-600">USD ${Ch_total.toFixed(2)}</span></p>
                <p class="text-md font-extrabold text-gray-900 pt-2 border-t border-cyan-400 mt-2">PRESUPUESTO TOTAL ($\text{C}_{\text{total}}$): <span class="float-right text-2xl text-cyan-700">USD ${C_total.toFixed(2)}</span></p>
            </div>
        `;
        resultsDiv.classList.remove('hidden');
        displayMessage("ADHSM: Reporte de presupuesto generado. Utilice estos datos para la planificación financiera del proyecto.", false);
    }

    // --- MÓDULO 3: TABLA DE REFERENCIA RÁPIDA ---

    function renderModule3() {
        currentModule = 3;
        messageBox.classList.add('hidden');
        appContainer.innerHTML = `
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center border-b pb-2">Módulo 3: Tabla de Referencia Rápida</h2>
            <p class="text-sm text-gray-600 mb-4">Referencia rápida para gases TIG (EN ISO 14175) y tipos de tungsteno (AWS).</p>

            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-300 rounded-lg text-xs">
                    <thead>
                        <tr class="bg-cyan-100">
                            <th class="px-3 py-2 text-left text-gray-700">Proceso/Material</th>
                            <th class="px-3 py-2 text-left text-gray-700">Gas Protector (Típico)</th>
                            <th class="px-3 py-2 text-left text-gray-700">Tipo de Tungsteno</th>
                            <th class="px-3 py-2 text-left text-gray-700">Color</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-t">
                            <td class="px-3 py-3 font-medium text-gray-800">TIG DC / Acero Inoxidable</td>
                            <td class="px-3 py-3">Argón Puro (I1)</td>
                            <td class="px-3 py-3">Torio 2% ($\text{ThO}_2$)</td>
                            <td class="px-3 py-3 bg-red-100 text-red-700 font-semibold rounded-lg">Rojo</td>
                        </tr>
                        <tr class="border-t bg-gray-50">
                            <td class="px-3 py-3 font-medium text-gray-800">TIG DC / Acero al Carbono</td>
                            <td class="px-3 py-3">Argón Puro (I1)</td>
                            <td class="px-3 py-3">Lantano 1.5% ($\text{La}_2\text{O}_3$)</td>
                            <td class="px-3 py-3 bg-yellow-100 text-yellow-700 font-semibold rounded-lg">Oro</td>
                        </tr>
                        <tr class="border-t">
                            <td class="px-3 py-3 font-medium text-gray-800">TIG AC / Aluminio</td>
                            <td class="px-3 py-3">Argón Puro (I1)</td>
                            <td class="px-3 py-3">Circonio ($\text{ZrO}_2$) o Lantano 1.5%</td>
                            <td class="px-3 py-3 bg-orange-100 text-orange-700 font-semibold rounded-lg">Café/Oro</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <p class="text-xs text-gray-500 mt-4">Nota: El Torio es radioactivo, se recomienda el Lantano (Oro) como sustituto de alto rendimiento para DC.</p>

            <button onclick="renderMenu()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 mt-6 rounded-lg transition duration-150">
                ← Volver al Menú
            </button>
        `;
    }

    // Inicializar la aplicación al cargar la ventana
    window.onload = renderMenu;
</script>

</body>
</html>
